<div class="admin-reports-container">
  <h2>Reportes</h2>
  <p>Panel de reportes y estadísticas de eventos.</p>

  <!-- Report selector and export options -->
  <div class="reports-controls">
    <div class="selector-section">
      <label for="reportSelect">Selecciona un reporte:</label>
      <select 
        id="reportSelect"
        [(ngModel)]="selectedReport" 
        (change)="onReportChange()"
        class="report-selector"
      >
        <option value="attendees-per-day">Asistencia por Día</option>
        <option value="emprendimiento-stats">Estadísticas por Emprendimiento</option>
        <option value="top-assistance">Top Emprendimientos - Asistencia</option>
        <option value="top-absence">Top Emprendimientos - Ausencias</option>
      </select>
    </div>
  </div>

  <!-- Asistencia por Día Report -->
  <div class="report-section" *ngIf="selectedReport === 'attendees-per-day'">
    <h3>Asistencia por Día</h3>
    <div class="table-container" *ngIf="attendancePerDay.length > 0">
      <table class="report-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Total Asistentes</th>
            <th>Asistieron</th>
            <th>Ausentes</th>
            <th>Tasa Asistencia</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let day of attendancePerDay" [ngClass]="{'high-attendance': (day.attended / day.totalAttendees) > 0.7}">
            <td>{{ day.date | date:'dd/MM/yyyy' }}</td>
            <td class="center">{{ day.totalAttendees }}</td>
            <td class="center success">{{ day.attended }}</td>
            <td class="center danger">{{ day.absent }}</td>
            <td class="center">{{ ((day.attended / day.totalAttendees) * 100).toFixed(0) }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estadísticas por Emprendimiento Report -->
  <div class="report-section" *ngIf="selectedReport === 'emprendimiento-stats'">
    <h3>Estadísticas por Emprendimiento</h3>
    <div class="table-container" *ngIf="emprendimientoStats.length > 0">
      <table class="report-table">
        <thead>
          <tr>
            <th>Emprendimiento</th>
            <th>Asistieron</th>
            <th>Ausentes</th>
            <th>Registrados</th>
            <th>Tasa Asistencia</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stats of emprendimientoStats" [ngClass]="{'high-attendance': getAttendanceRate(stats) > 70}">
            <td>{{ stats.emprendimiento }}</td>
            <td class="center success">{{ stats.attended }}</td>
            <td class="center danger">{{ stats.absent }}</td>
            <td class="center">{{ stats.registered }}</td>
            <td class="center"><span class="attendance-badge">{{ getAttendanceRate(stats) }}%</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Top Assistance Report -->
  <div class="report-section" *ngIf="selectedReport === 'top-assistance'">
    <h3>Top Emprendimientos - Mayor Asistencia</h3>
    <div class="rankings-container" *ngIf="topAssistance.length > 0">
      <div *ngFor="let item of topAssistance; let i = index" class="ranking-card">
        <div class="rank-position">{{ i + 1 }}</div>
        <div class="rank-info">
          <h4>{{ item.emprendimiento }}</h4>
          <div class="rank-stats">
            <span class="stat success">{{ item.attended }} asistieron</span>
            <span class="stat">{{ item.registered }} registrados</span>
          </div>
        </div>
        <div class="rank-percentage">{{ getAttendanceRate(item) }}%</div>
      </div>
    </div>
  </div>

  <!-- Top Absence Report -->
  <div class="report-section" *ngIf="selectedReport === 'top-absence'">
    <h3>Top Emprendimientos - Mayor Ausencia</h3>
    <div class="rankings-container" *ngIf="topAbsence.length > 0">
      <div *ngFor="let item of topAbsence; let i = index" class="ranking-card">
        <div class="rank-position">{{ i + 1 }}</div>
        <div class="rank-info">
          <h4>{{ item.emprendimiento }}</h4>
          <div class="rank-stats">
            <span class="stat danger">{{ item.absent }} ausentes</span>
            <span class="stat">{{ item.registered }} registrados</span>
          </div>
        </div>
        <div class="rank-percentage">{{ ((item.absent / item.registered) * 100).toFixed(0) }}%</div>
      </div>
    </div>
  </div>
</div>
